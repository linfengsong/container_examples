
docker-job: 
  stage: docker
  script:
    - |
      echo "start build docker image"
      
      mkdir -p $GITLAB_UTILS_PATH
      tar xf gitlab_utils.tar -C $GITLAB_UTILS_PATH
      export PATH=$GITLAB_UTILS_PATH/tool:$PATH
      
      env_name=dev
      srcPath=$(pwd)
      iniFilePath=$srcPath/conf/image_${env_name}.ini
      buildPath=$srcPath/target/build
      
      mkdir -p $buildPath/image
      cp -R $GITLAB_UTILS_PATH/build/* $buildPath
      if [[ ! -z "$CI_BUILD_TARGET_PATH" ]]; then cp -R $CI_BUILD_TARGET_PATH $buildPath/image; fi
      $GITLAB_UTILS_PATH/script/docker_build.sh "$iniFilePath" "$buildPath"
      
      echo "finish build docker image"
